\documentclass[12pt]{report}

\usepackage{fullpage}
\usepackage{graphicx}

\begin{document}

\chapter{DCB File Format}
The Deskcorder binary (DCB) file format is what Deskcorder uses to save and load lectures.  Fig.~\ref{fig:dcb-ff} shows a graphical representation of the file format.

\begin{figure}[ht]
  \centering
  \includegraphics[width=\columnwidth]{figures/dcb-ff}
  \caption{An outline of the most-recent Deskcorder binary file format (v.0.1.1). Long boxes are 8 bytes, short ones 4. All boxes without types are integers.}
  \label{fig:dcb-ff}
\end{figure}

\section{Top Level}
The file is formatted as an array of arrays.  At the top level is an 8-byte ``magic number" that was chosen randomly to be hexadecimal {\tt 42FA32BA22AAAABB}.  The purpose of this number is to make it unlikely that a non-DCB file will be mis-recognized as a file containing a valid lecture.  Next comes the version number (currently v.1.0.0) in major, minor, and bug order.  Especially during development, this file format changes from commit to commit, so this number is used upon read to distinguish between implementations of the file.  The major version corresponds to the release version of the desktop application it was created during. The minor version corresponds to an alteration (usually an improvement) in the format, and the bug version corresponds to bug fixes in the DCB-saving function.  These numbers are each 4-byte integers.  After the slides, come the number and list of moves, then lastly the number and list of audio files.

\section{Slides}
Next comes a 4-bit integer that lists the number of slides, followed by that number of slides.  Each slide's entry is an 8-bit Unix time stamp (the time the slide was created\footnote{This will either be the time that the program started (for the first slide) or the time that the slide was created.}) followed by the number of strokes in that slide, and then entries for those strokes.

\section{Stroke}
Each stroke's entry starts with the number of points in that stroke.  If that number is 0, the entry is done.  If it's greater than 0, then the entry continues with a color stored as $(r,g,b)$, where $r,g,b\in[0,1]$, 1 meaning ``full intensity" and 0 meaning ``black".  Lastly, the points in this stroke are listed.

\section{Point}
Each point's entry consists of an 8-byte Unix time stamp, normalized $(x,y)$ coordinates (4 bytes per coordinate; both coordinates a floating-point number), and the amount of pressure on the pen.  $x$ and $y$ are in $[0,1]$, so that the drawing canvas can be infinitely scaled, and so that the lecture can be played on any size canvas on any computer without losing information.

\section{Moves}
Each move's entry consists of an 8-byte Unix time stamp and an $(x,y)$ pair of 4-byte floating-point numbers, where $x,y\in[0,1]$.

\section{Audio}
Each audio entry has an 8-byte Unix time stamp and an 8-byte integer\footnote{We chose to use an 8-byte integer here, because this data tends to be quite long.} with the length of the {\tt zlib}-compressed data, followed by the {\tt zlib}-compressed data.

\end{document}
